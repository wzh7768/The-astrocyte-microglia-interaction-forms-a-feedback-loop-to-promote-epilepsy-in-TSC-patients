#Integrate multiple Seurat objects containing RNA velocity information
library(harmony)
sce_comb <- merge(TSC4,TSC3)
sce_comb <- merge(sce_comb,TSC2)
sce_comb <- merge(sce_comb,TSC1)
sce_comb <- merge(sce_comb,control1)
sce_comb <- merge(sce_comb,control2)
sce_comb <- merge(sce_comb,control3)
save(sce_comb,file='sce_comb.Rdata')
sce_comb <- SCTransform(sce_comb)
TSC <- RunPCA(sce_comb,npcs=50,verbose=FALSE)
TSC <- RunHarmony(TSC, group.by.vars = "orig.ident", assay.use = "SCT",max.iter.harmony = 30)
ElbowPlot(TSC, ndims=50)
TSC <- FindNeighbors(TSC, reduction = "harmony", dims = 1:30)
TSC <- FindClusters(TSC, resolution = 0.8)
TSC <- RunUMAP(TSC,reduction = "harmony", dims = 1:30)
save(TSC,file='TSC_total.Rdata')
